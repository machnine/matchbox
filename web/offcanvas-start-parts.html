<div class="offcanvas-header">
  <h5 id="offcanvasInfoLabel">
    <i class="bi bi-info-square text-info"></i>
    cRF Calculator
  </h5>
  <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
</div>
<div class="offcanvas-body xsmall">
  <p class="fw-bold">Calculator results display:</p>
  <img src="{{ url_for('static', path='results-display.png') }}" height="30" width="330" class="mb-2"
    alt="result display image" />
  <ul class="list-group">
    <li class="list-group-item">
      <i class="text-danger">cRF</i> - calculated reaction frequency
    </li>
    <li class="list-group-item">
      <i class="text-primary">Mp</i> - calculated matchability point
    </li>
    <li class="list-group-item">
      <i class="text-warning">Fm</i> - favourably matched donors
    </li>
    <li class="list-group-item">
      <i class="text-info">Ad</i> - available HLA compatible donors/total donors
    </li>
    <li class="list-group-item">
      <i class="text-success bi bi-toggle2-on">A</i> all 10,000 donors
    </li>
    <li class="list-group-item">
      <i class="text-success bi bi-toggle2-off">D</i> only donors with HLA-DPB1 types
    </li>
  </ul>

  <hr />
  <p class="fw-bold">Matchability point bands:</p>
  <table class="table table-sm text-center table-bordered table-striped">
    <tr>
      <th>BG</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>10</th>
    </tr>
    {% for bg, val in mbands.items() %}
    <tr>
      <td>{{ bg }}</td>
      <td>{{ val[1] }}</td>
      <td>{{ val[2] }}</td>
      <td>{{ val[3] }}</td>
      <td>{{ val[4] }}</td>
      <td>{{ val[5] }}</td>
      <td>{{ val[6] }}</td>
      <td>{{ val[7] }}</td>
      <td>{{ val[8] }}</td>
      <td>{{ val[9] }}</td>
      <td>{{ val[10] }}</td>
    </tr>
    {% endfor %}
  </table>
  <p>
    For each blood group, patients are assigned to an
    <i class="text-primary">Mp</i>
    band based on the maximum number of favourably matched donors (<i class="text-warning">Fm</i>) they have.
    The <i class="text-primary">Mp</i> bands are defined by specific <i class="text-warning">Fm</i>
    threshold values as outlined in the table above.
  </p>
  <p>
    <i class="text-muted">
      NB: The banding is subject to change as the calculator is updated by NHSBT-ODT. There is no set schedule.
    </i>
  </p>
  <hr />
  <p class="fw-bold">HLA type for matchability calculation:</p>
  <p>
    Matchability estimates how many levels 1 and 2 mismatched, ABO-identical, and HLA-compatible donors (a.k.a.
    favourably matched donors, <i class="text-warning">Fm</i>) are available for a patient within the 10,000 donor
    cohort.
  </p>
  <p>
    The calculation is based on <b>broad</b> HLA specificities. For determining favourable matches (levels 1 and 2),
    only HLA-B and DRB1 are needed: HLA-A does
    not affect this categorisation.
  </p>
  <table class="table table-sm text-center table-bordered table-striped">
    <tr>
      <th colspan="3" class="text-center">HLA mismatch levels for HLA-A, B and DR</th>
    </tr>
    <tr>
      <th>Level</th>
      <th>Summary</th>
      <th>Combinations included</th>
    </tr>
    <tr>
      <td>1</td>
      <td>000</td>
      <td>000</td>
    </tr>
    <tr>
      <td>2</td>
      <td>[0 DR and 0/1 B] or [1 DR and 0 B]</td>
      <td>100, 010, 110, 200, 210, 001, 101, 201</td>
    </tr>
    <tr>
      <td>3</td>
      <td>[0 DR and 2 B] or [1 DR and 1 B]</td>
      <td>020, 120, 220, 011, 111, 211</td>
    </tr>
    <tr>
      <td>4</td>
      <td>[1 DR and 2 B] or [2 DR]</td>
      <td>021, 121, 221, 002, 102, 202, 012, 112, 212, 022, 122, 222</td>
    </tr>
  </table>
  <i>
    Ref:
    <a href="https://www.odt.nhs.uk/transplantation/tools-policies-and-guidance/policies-and-guidance/" target="_blank">
      NHSBT-ODT Kidney Allocation Policy - <b>POL186</b>
    </a>
  </i>
</div>